# Workflow 名稱
name: Weekly Weather Report Autosend

# --------------------------
# 觸發條件
# --------------------------
on:
  # 排程：台灣時間 06:30 開始，每 6 小時執行一次
  # 對應 UTC 時間：22:30（前一天）、04:30、10:30、16:30
  schedule:
    - cron: '30 22,4,10,16 * * *'  # UTC 時間，對應台灣 06:30, 12:30, 18:30, 00:30

  # 手動觸發
  workflow_dispatch:

# --------------------------
# 工作任務
# --------------------------
jobs:
  run-autosend:
    runs-on: windows-latest

    steps:
      # 步驟 1: 檢出程式碼
      - name: Checkout repository
        uses: actions/checkout@v4

      # 步驟 2: 設定 Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 步驟 3: 檢查 requirements.txt
      - name: Check requirements.txt
        run: |
          if (Test-Path "requirements.txt") {
            echo "requirements.txt 存在"
            Get-Content requirements.txt
          } else {
            echo "requirements.txt 不存在！"
            exit 1
          }

      # 步驟 4: 安裝套件
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          echo "已安裝套件："
          pip list

      # 步驟 5: 顯示執行時間（UTC ↔ 台灣時間）
      - name: Show execution time (UTC → 台灣時間)
        run: |
          $utc = Get-Date
          $taiwan = $utc.AddHours(8)
          echo "=== 執行時間對照 ==="
          echo "UTC 時間     : $($utc.ToString('yyyy-MM-dd HH:mm:ss'))"
          echo "台灣時間     : $($taiwan.ToString('yyyy-MM-dd HH:mm:ss')) (UTC+8)"
          echo "排程設定     : 台灣時間 06:30, 12:30, 18:30, 00:30"
          echo "下次執行     : 距離下個 6 小時點"

      # 步驟 6: 執行主程式
      - name: Execute weekly_auto_send.py
        run: |
          python weekly_auto_send.py
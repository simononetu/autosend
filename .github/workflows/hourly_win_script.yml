# Workflow 的名稱，顯示在 GitHub Actions 頁籤中
name: Hourly Autosend Script Runner

# --------------------------
# 觸發條件 (Triggers)
# --------------------------
on:
  # 1. 排程觸發：每小時的第 0 分鐘自動運行 (UTC 時間)
  schedule:
    - cron: '0 * * * *' 
  
  # 2. 手動觸發：允許使用者在 Actions 頁面點擊「Run workflow」按鈕立即執行
  workflow_dispatch:
    
# --------------------------
# 工作任務 (Jobs)
# --------------------------
jobs:
  run-autosend:
    runs-on: windows-latest 
    
    steps:
      # 步驟 1: 檢出（Clone）儲存庫程式碼
      - name: Checkout repository
        uses: actions/checkout@v4
        
      # 步驟 2: 設定 Python 環境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      # 步驟 3: 檢查 requirements.txt 是否存在
      - name: Check requirements.txt
        run: |
          if (Test-Path "requirements.txt") {
            echo "✅ requirements.txt 存在"
            echo "內容："
            Get-Content requirements.txt
          } else {
            echo "❌ requirements.txt 不存在！"
            exit 1
          }
      
      # 步驟 4: 安裝依賴
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          echo "已安裝的套件："
          pip list
        
      # 步驟 5: 顯示當前時間（除錯用）
      - name: Show current time
        run: |
          echo "UTC 時間: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')"
          echo "台灣時間應為 UTC+8"
        
      # 步驟 6: 執行您的 Python 腳本（在腳本內處理時區）
      - name: Execute Python Script
        run: |
          python hourly_auto_send.py